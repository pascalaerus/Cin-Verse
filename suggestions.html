<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cin√©Verse | Suggestions</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
:root {
    --primary-color: #e50914;
    --secondary-color: #ffcc00;
    --bg-dark: #0f0f0f;
    --card-bg: #1a1a1a;
    --text-light: #ffffff;
    --text-gray: #b3b3b3;
}
body { font-family: 'Poppins', sans-serif; background-color: var(--bg-dark); color: var(--text-light); margin:0; }
header { text-align:center; padding:40px 20px; }
header h1 { color: var(--primary-color); font-size:2.5rem; }
.tabs { display:flex; justify-content:center; margin-bottom:20px; gap:10px; flex-wrap:wrap; }
.tab-btn { padding:10px 25px; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:0.3s; }
.tab-btn.active { background: var(--primary-color); color:white; }
.tab-btn.inactive { background: #222; color:var(--text-gray); }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; padding:0 20px 40px; display:none; }
.card { background: var(--card-bg); border-radius:12px; overflow:hidden; text-align:center; transition:0.3s; border:1px solid #222; display:flex; flex-direction:column; }
.card img { width:100%; display:block; }
.card-content { padding:15px; flex-grow:1; display:flex; flex-direction:column; }
.card-content h3 { font-size:1.1rem; margin-bottom:10px; }
.card-content p { font-size:0.9rem; color: var(--text-gray); flex-grow:1; margin-bottom:5px; }
.see-more { font-size:0.85rem; color: var(--secondary-color); cursor:pointer; margin-bottom:10px; display:inline-block; }
.btn-req { background: var(--primary-color); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:600; text-align:center; }
.btn-req:hover { opacity:0.9; }
.btn-anon { background: var(--secondary-color); color:#000; font-size:1rem; padding:12px 20px; margin-bottom:20px; display:inline-block; text-decoration:none; }
.btn-anon:hover { opacity:0.85; }
</style>
</head>
<body>

<header>
    <h1>Cin√©Verse | Suggestions</h1>
    <a href="https://ngl.link/pascal_aerus22519" target="_blank" class="btn-anon">üíå Suggestions anonymes</a>
</header>

<div class="tabs">
    <button class="tab-btn active" data-target="moviesGrid">Films populaires</button>
    <button class="tab-btn inactive" data-target="seriesGrid">S√©ries populaires</button>
</div>

<div class="grid" id="moviesGrid"></div>
<div class="grid" id="seriesGrid"></div>

<script>
// EmailJS init
emailjs.init("nwNk-9LbyO0XHfwql");

// TMDB API
const TMDB_API_KEY = "343afb1d4a8c081ad737a2aef2f96d9a";
const moviesGrid = document.getElementById("moviesGrid");
const seriesGrid = document.getElementById("seriesGrid");
let moviesPage = 1;
let seriesPage = 1;

// Onglets
const tabBtns = document.querySelectorAll('.tab-btn');
tabBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
        tabBtns.forEach(b=>{b.classList.remove('active'); b.classList.add('inactive');});
        btn.classList.add('active'); btn.classList.remove('inactive');
        document.querySelectorAll('.grid').forEach(g=>g.style.display='none');
        document.getElementById(btn.getAttribute('data-target')).style.display='grid';
    });
});
// Afficher films au d√©part
moviesGrid.style.display = 'grid';

// Cr√©er carte
function createCard(title, overview, poster, type){
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
        <img src="https://image.tmdb.org/t/p/w500${poster}" alt="${title}">
        <div class="card-content">
            <h3>${title}</h3>
            <p class="short">${overview.length>150 ? overview.substring(0,150)+"..." : overview}</p>
            <p class="full" style="display:none;">${overview}</p>
            ${overview.length>150 ? '<span class="see-more">Voir plus</span>' : ''}
            <button class="btn-req" onclick="requestContent('${title}','${type}')">Demander ce ${type.toLowerCase()}</button>
        </div>
    `;
    const seeMore = card.querySelector('.see-more');
    if(seeMore){
        seeMore.addEventListener('click', ()=>{
            const shortP = card.querySelector('.short');
            const fullP = card.querySelector('.full');
            if(fullP.style.display==='block'){
                fullP.style.display='none';
                shortP.style.display='block';
                seeMore.innerText='Voir plus';
            } else {
                fullP.style.display='block';
                shortP.style.display='none';
                seeMore.innerText='Voir moins';
            }
        });
    }
    return card;
}

// Charger films
async function loadMovies(){
    const res = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${TMDB_API_KEY}&language=fr&page=${moviesPage}`);
    const data = await res.json();
    data.results.forEach(movie=>{
        moviesGrid.appendChild(createCard(movie.title, movie.overview, movie.poster_path, 'Film'));
    });
    moviesPage++;
}

// Charger s√©ries
async function loadSeries(){
    const res = await fetch(`https://api.themoviedb.org/3/tv/popular?api_key=${TMDB_API_KEY}&language=fr&page=${seriesPage}`);
    const data = await res.json();
    data.results.forEach(tv=>{
        seriesGrid.appendChild(createCard(tv.name, tv.overview, tv.poster_path, 'S√©rie'));
    });
    seriesPage++;
}

// Scroll infini
window.addEventListener('scroll', ()=>{
    if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 100){
        loadMovies();
        loadSeries();
    }
});

// Demander contenu
function requestContent(title,type){
    const userEmail = prompt("Entrez votre email pour recevoir la confirmation :");
    if(!userEmail){ alert("Email requis !"); return; }

    // WhatsApp
    const phone = "22996326185";
    const message = `üé¨ *NOUVELLE DEMANDE CIN√âVERSE* üé¨%0A%0A`+
                    `üìå *Type:* ${type}%0A`+
                    `üéûÔ∏è *Titre:* ${title}%0A`+
                    `%0A_Demande effectu√©e depuis le site web._`;
    window.open(`https://wa.me/${phone}?text=${message}`,'_blank');

    // Email confirmation via EmailJS
    emailjs.send("service_7njbqib","template_dzcv9gj",{
        user_email:userEmail,
        content_title:title,
        content_type:type,
        status:"Votre demande a √©t√© re√ßue !"
    }).then(()=>{ alert("‚úÖ Votre demande a √©t√© envoy√©e ! Vous recevrez un mail de confirmation."); });
}

// Appels init
loadMovies();
loadSeries();

</script>
</body>
</html>