<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cin√©Verse | Suggestions</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<style>
:root {
    --primary-color:#e50914;
    --bg-dark:#0f0f0f;
    --card-bg:#1a1a1a;
    --input-bg:#333;
    --text-light:#fff;
    --text-gray:#b3b3b3;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;background:var(--bg-dark);color:var(--text-light);line-height:1.6;}
header{height:20vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;background:var(--bg-dark);}
header .logo{font-size:2.5rem;font-weight:700;color:var(--primary-color);}
nav{display:flex;justify-content:center;gap:20px;margin:20px 0;}
nav button{padding:10px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:600;transition:0.3s;}
nav button.active{background:#25D366;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin-bottom:40px;}
.card{background:var(--card-bg);padding:20px;border-radius:15px;border:1px solid #222;transition:0.3s;position:relative;}
.card:hover{transform:translateY(-5px);border-color:var(--primary-color);}
.card img{width:100%;border-radius:10px;}
.card h3{margin:10px 0 5px;}
.card p{color:var(--text-gray);font-size:0.9rem;max-height:60px;overflow:hidden;}
.card .see-more{color:var(--primary-color);cursor:pointer;font-size:0.85rem;margin-top:5px;display:inline-block;}
.card button{margin-top:10px;padding:8px 12px;background:#25D366;color:#fff;border:none;border-radius:5px;cursor:pointer;width:100%;transition:0.3s;}
.card button:hover{opacity:0.9;}
.anonymous{display:block;text-align:center;margin:20px auto;padding:12px 20px;background:#ffcc00;color:#000;border:none;border-radius:5px;text-decoration:none;font-weight:600;width:fit-content;transition:0.3s;}
.anonymous:hover{opacity:0.8;}
</style>
</head>
<body>

<header>
<div class="logo">Cin√©Verse Suggestions</div>
<p>D√©couvrez et demandez vos films et s√©ries pr√©f√©r√©s</p>
</header>

<nav>
<button id="btn-films" class="active">Films Populaires</button>
<button id="btn-series">S√©ries Populaires</button>
</nav>

<div class="container">
<div id="grid" class="grid"></div>
<a href="https://ngl.link/pascal_aerus22519" class="anonymous" target="_blank"><i class="fas fa-user-secret"></i> Suggestions Anonymes</a>
</div>

<script>
emailjs.init("nwNk-9LbyO0XHfwql");
const TMDB_API_KEY="343afb1d4a8c081ad737a2aef2f96d9a";
let page=1,type="movie";

const grid=document.getElementById("grid");
const btnFilms=document.getElementById("btn-films");
const btnSeries=document.getElementById("btn-series");

btnFilms.addEventListener("click",()=>{
  type="movie"; page=1; grid.innerHTML=""; btnFilms.classList.add("active"); btnSeries.classList.remove("active"); loadSuggestions();
});
btnSeries.addEventListener("click",()=>{
  type="tv"; page=1; grid.innerHTML=""; btnSeries.classList.add("active"); btnFilms.classList.remove("active"); loadSuggestions();
});

async function loadSuggestions(){
  const res=await fetch(`https://api.themoviedb.org/3/${type}/popular?api_key=${TMDB_API_KEY}&language=fr&page=${page}`);
  const data=await res.json();
  data.results.forEach(item=>{
    const seasons=type==='tv'?item.number_of_seasons || 1:1;
    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" alt="${item.title||item.name}">
      <h3>${item.title||item.name}</h3>
      <p>${(type==='movie'?item.overview:item.overview).substring(0,150)}<span class="more" style="display:none;">${(type==='movie'?item.overview:item.overview).substring(150)}</span></p>
      <span class="see-more">Voir plus</span>
      <button>Demander ${type==='movie'?'ce film':'cette s√©rie'}</button>
    `;
    grid.appendChild(card);

    // Voir plus
    const seeMore=card.querySelector(".see-more");
    const p=card.querySelector("p");
    seeMore.addEventListener("click",()=>{
      p.innerHTML=(item.overview)+"";
      seeMore.style.display="none";
    });

    // Bouton demande
    const btn=card.querySelector("button");
    btn.addEventListener("click",async ()=>{
      // Nom et email utilisateur
      const user_name=prompt("Entrez votre nom :");
      const user_email=prompt("Entrez votre email :");
      if(!user_name || !user_email){ alert("Nom et email requis !"); return; }

      // V√©rification s√©ries >3 saisons
      if(type==='tv' && seasons>3){
        const code=prompt("Cette s√©rie a plus de 3 saisons. Entrez le code Premium :");
        if(code!=="AMIDEPASCAL"){ alert("DEMANDE REJET√âE : Vous n'√™tes pas Premium !"); return; }
      }

      // WhatsApp
      const phone="22996326185";
      const message=`üé¨ *NOUVELLE DEMANDE CIN√âVERSE* üé¨%0A%0A`+
                    `üë§ Nom: ${user_name}%0A`+
                    `üìå Type: ${type==='movie'?'Film':'S√©rie'}%0A`+
                    `üéûÔ∏è Titre: ${item.title||item.name}%0A`+
                    (type==='tv' && seasons>3?`üîë Code Premium utilis√© ‚úÖ%0A`:"")+
                    `%0A_Demande effectu√©e depuis le site web._`;
      window.open(`https://wa.me/${phone}?text=${message}`,'_blank');

      // EmailJS
      emailjs.send("service_7njbqib","template_dzcv9gj",{
        user_name:user_name,
        user_email:user_email,
        content_title:item.title||item.name,
        content_type:type==='movie'?"Film":"S√©rie",
        seasons:seasons,
        status:"Demande re√ßue !"
      });

      alert("‚úÖ Votre demande a √©t√© envoy√©e ! Un mail de confirmation vous a √©t√© envoy√©.");
    });
  });
}

// Scroll infini
window.addEventListener("scroll",()=>{
  if(window.innerHeight+window.scrollY>=document.body.offsetHeight-100){ page++; loadSuggestions(); }
});

// Chargement initial
loadSuggestions();
</script>

</body>
</html>